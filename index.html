<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-recruit-dashboard</title>
    <style>
      .fb-customerchat {
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        z-index: 999999 !important;
        width: 60px !important;
        height: 60px !important;
        opacity: 1 !important;
        visibility: visible !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        background-color: transparent !important;
        border: none !important;
        max-height: calc(100vh - 40px) !important;
        pointer-events: auto !important;
      }
      
      #custom-chat-frame {
        display: flex !important;
        flex-direction: column !important;
        width: 350px !important;
        max-width: calc(100vw - 40px) !important;
        height: 500px !important;
        max-height: calc(100vh - 40px) !important;
        background-color: white !important;
        border-radius: 10px !important;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
        border: 1px solid #e0e0e0 !important;
        position: fixed !important;
        bottom: 20px !important;
        right: 20px !important;
        z-index: 999999 !important;
        pointer-events: auto !important;
      }
      
      .fb-customerchat > div:not(#chat-button):not(#custom-chat-frame) {
        display: none !important;
      }
      
      #chat-button {
        display: flex !important;
      }
      
      .fb-customerchat iframe {
        display: none !important;
      }
      
      #custom-chat-frame {
        font-family: Arial, sans-serif;
      }
      
      #chat-messages {
        font-size: 14px;
        line-height: 1.4;
      }
      
      #chat-input {
        font-size: 14px;
        outline: none;
      }
      
      #chat-input:focus {
        border-color: #0084ff !important;
      }
      
      /* Ensure chat widget is always on top */
      .fb-customerchat * {
        z-index: 999999 !important;
      }
      
      /* Hide any potential overlays that might interfere */
      body > div:not(#root):not(.fb-customerchat):not(#fb-root) {
        z-index: 1 !important;
      }
      
      /* Responsive design for mobile devices */
      @media (max-width: 768px) {
        .fb-customerchat {
          bottom: 10px !important;
          right: 10px !important;
          z-index: 999999 !important;
        }
        
        #custom-chat-frame {
          width: calc(100vw - 20px) !important;
          max-width: calc(100vw - 20px) !important;
          height: calc(100vh - 20px) !important;
          max-height: calc(100vh - 20px) !important;
          border-radius: 0 !important;
          position: fixed !important;
          top: 10px !important;
          left: 10px !important;
          right: 10px !important;
          bottom: 10px !important;
          z-index: 999999 !important;
        }
      }
      
      @media (max-width: 480px) {
        .fb-customerchat {
          bottom: 5px !important;
          right: 5px !important;
          z-index: 999999 !important;
        }
        
        #custom-chat-frame {
          width: calc(100vw - 10px) !important;
          max-width: calc(100vw - 10px) !important;
          height: calc(100vh - 10px) !important;
          max-height: calc(100vh - 10px) !important;
          top: 5px !important;
          left: 5px !important;
          right: 5px !important;
          bottom: 5px !important;
          z-index: 999999 !important;
        }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Facebook Customer Chat Plugin -->
    <div id="fb-root"></div>
    <div id="fb-customer-chat" class="fb-customerchat" 
         data-page_id="830352943493751" 
         data-attribution="biz_inbox"
         data-theme_color="#0084ff"
         data-logged_in_greeting="Xin ch√†o! Ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?"
         data-logged_out_greeting="Xin ch√†o! Ch√∫ng t√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?"></div>
    
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId: '797708303042269',
          xfbml: true,
          version: 'v18.0'
        });
        console.log('Facebook SDK initialized');
        
        // Parse the chat widget after SDK is ready
        setTimeout(function() {
          console.log('Parsing XFBML...');
          if (FB && FB.XFBML) {
            FB.XFBML.parse();
            console.log('XFBML parsed successfully');
            
            // Force re-parse after a delay
            setTimeout(function() {
              console.log('Force re-parsing XFBML...');
              FB.XFBML.parse();
              
              // Always show custom chat button (Facebook SDK often fails)
              setTimeout(function() {
                console.log('Showing custom chat button');
                var chatContainer = document.querySelector('.fb-customerchat');
                if (chatContainer) {
                  chatContainer.innerHTML = '<div id="chat-button" style="width: 60px; height: 60px; background-color: #0084ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.15);" onclick="toggleChat()">üí¨</div>';
                }
              }, 500);
            }, 2000);
          } else {
            console.warn('FB.XFBML not available');
          }
        }, 1000);
      };

      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v18.0";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
      
      // Function to toggle chat
      function toggleChat() {
        var chatContainer = document.querySelector('.fb-customerchat');
        var chatButton = document.getElementById('chat-button');
        var chatFrame = document.getElementById('custom-chat-frame');
        
        if (chatFrame && chatFrame.style.display !== 'none') {
          // Hide chat frame, show button
          chatFrame.style.display = 'none';
          chatButton.style.display = 'flex';
        } else {
          // Show chat frame, hide button
          chatButton.style.display = 'none';
          
          // Calculate optimal height based on viewport and screen size
          var viewportHeight = window.innerHeight;
          var viewportWidth = window.innerWidth;
          var isMobile = viewportWidth <= 768;
          var isSmallMobile = viewportWidth <= 480;
          
          var maxHeight, chatHeight, chatWidth;
          
          if (isSmallMobile) {
            chatWidth = 'calc(100vw - 10px)';
            maxHeight = viewportHeight - 10;
            chatHeight = maxHeight;
          } else if (isMobile) {
            chatWidth = 'calc(100vw - 20px)';
            maxHeight = viewportHeight - 20;
            chatHeight = maxHeight;
          } else {
            chatWidth = '350px';
            maxHeight = Math.min(500, viewportHeight - 40);
            chatHeight = Math.max(400, maxHeight);
          }
          
          var borderRadius = isMobile ? '0' : '10px';
          var headerBorderRadius = isMobile ? '0' : '10px 10px 0 0';
          var positionStyle = isMobile ? 'position: fixed; top: 10px; left: 10px; right: 10px; bottom: 10px;' : 'position: fixed; bottom: 20px; right: 20px;';
          
          chatContainer.innerHTML = '<div id="custom-chat-frame" style="width: ' + chatWidth + '; max-width: ' + chatWidth + '; height: ' + chatHeight + 'px; max-height: ' + chatHeight + 'px; background-color: white; border-radius: ' + borderRadius + '; box-shadow: 0 4px 20px rgba(0,0,0,0.15); border: 1px solid #e0e0e0; display: flex; flex-direction: column; ' + positionStyle + ' z-index: 999999; pointer-events: auto;"><div style="background-color: #0084ff; color: white; padding: 15px; border-radius: ' + headerBorderRadius + '; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">Chat v·ªõi AI RECRUIT<span style="cursor: pointer; font-size: 18px;" onclick="toggleChat()">√ó</span></div><div id="chat-messages" style="flex: 1; padding: 15px; overflow-y: auto; background-color: #f8f9fa;"></div><div style="padding: 15px; border-top: 1px solid #e0e0e0; display: flex;"><input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 10px;"><button onclick="sendMessage()" style="background-color: #0084ff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">G·ª≠i</button></div></div>';
          
          // Add welcome message
          setTimeout(function() {
            var messages = document.getElementById('chat-messages');
            if (messages) {
              messages.innerHTML = '<div style="margin-bottom: 10px; text-align: left;"><div style="background-color: white; color: #333; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%; border: 1px solid #e0e0e0;">Xin ch√†o! T√¥i l√† bot AI RECRUIT. T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n?</div></div>';
            }
          }, 100);
        }
      }
      
      // Function to send message
      function sendMessage() {
        var input = document.getElementById('chat-input');
        var messages = document.getElementById('chat-messages');
        var message = input.value.trim();
        
        if (message) {
          // Add user message
          messages.innerHTML += '<div style="margin-bottom: 10px; text-align: right;"><div style="background-color: #0084ff; color: white; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%;">' + message + '</div></div>';
          
          // Clear input
          input.value = '';
          
          // Scroll to bottom
          messages.scrollTop = messages.scrollHeight;
          
          // Simulate bot response
          setTimeout(function() {
            messages.innerHTML += '<div style="margin-bottom: 10px; text-align: left;"><div style="background-color: white; color: #333; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%; border: 1px solid #e0e0e0;">C·∫£m ∆°n b·∫°n ƒë√£ li√™n h·ªá! Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi s·ªõm nh·∫•t c√≥ th·ªÉ.</div></div>';
            messages.scrollTop = messages.scrollHeight;
          }, 1000);
        }
      }
      
      // Allow Enter key to send message
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(function() {
          var input = document.getElementById('chat-input');
          if (input) {
            input.addEventListener('keypress', function(e) {
              if (e.key === 'Enter') {
                sendMessage();
              }
            });
          }
        }, 2000);
        
        // Fallback: Ensure chat button is always visible
        setTimeout(function() {
          var chatContainer = document.querySelector('.fb-customerchat');
          var chatButton = document.getElementById('chat-button');
          if (chatContainer && !chatButton) {
            console.log('Fallback: Creating chat button');
            chatContainer.innerHTML = '<div id="chat-button" style="width: 60px; height: 60px; background-color: #0084ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.15);" onclick="toggleChat()">üí¨</div>';
          }
        }, 3000);
      });
    </script>
  </body>
</html>
